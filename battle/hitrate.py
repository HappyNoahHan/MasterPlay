import random
from pets import statusmap
from assist import petattr

def hitOrNot(skill,rate,obj_attack,obj_defense,dodge):
    #ST107 电磁飘浮 免疫地面
    if skill.property == 'ground' and  'ST107' in obj_defense.status:
        print("电磁飘浮 免疫地面属性技能")
        return False
    #ST104 锁定状态 技能必定命中
    if skill.hit_rate == 0 or 'ST104' in obj_defense.status:
        print("%s 必定命中！" % skill.show_name)
        return True
    if 'ST121' in obj_defense.status: #被识破
        dodge = 0
    else:
        dodge = statusmap.checkDogeBeforHitCount(obj_defense,dodge)
    print("闪避等级 %s 级" % dodge)

    if obj_attack.level > obj_defense.level:
        level_index = 1 + (obj_attack.level - obj_defense.level) / obj_attack.level
    else:
        level_index = obj_attack.level / obj_defense.level
    real_rate = int((rate * level_index - dodge * 10) * 2.55)
    print("真实命中率:",real_rate)

    if real_rate >= 255:
        print("技能命中！")
        return True

    random_number = random.randint(1,255)

    #测试
    #print(random_number)

    if random_number <= real_rate:
        print("技能命中！")
        return True
    else:
        print("技能未命中！")
        return False


def hitForOneHitKill(obj_attack,obj_defense,skill):
    #属性相性不为0倍 后续
    #if petattr.getAttrMap(skill,obj_defense) == 0:
    #    return False

    if obj_attack.level < obj_defense.level:
        return False
    else:
        if 'ST104' in obj_defense.status:
            return True
        else:
            hit = 30+obj_attack.level-obj_defense.level
            real_rate = int(hit * 2.55)
            print("真实命中率:", real_rate)

            if real_rate >= 255:
                print("技能命中！")
                return True

            random_number = random.randint(1, 255)

            # 测试
            # print(random_number)

            if random_number <= real_rate:
                print("技能命中！")
                return True
            else:
                print("技能未命中！")
                return False